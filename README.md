# sql_bible


## RDBMSの差

1. mysql(mariadb)はガラパゴス
リレーショナルDBのくせにjoinが遅く、
8.0系になるまで分析関数も、Withもサポートしていなかった。
sqlite以下の機能。

mysqlのアップデートの罠

update 
name = 
name2 = name2 * 3

としてみよう。

癖がありすぎる

自動コミットという罠

RDBMSについての誤解を受けやすいので、
初めてのRDBMSとしては不向き。しかし、phpのフルスタックフレームワークは
mysql以外あまりテストしてないのもあるため、mysqlを

1. mysqlとmariadb
そもそもサンプルでさえ動かない。
お互い別の道を歩き始めているので、mysqlの代替として
mariadbは既に危険。

1. mysql, mariadbはかなり標準sqlをガン無視した作りのため、
他のRDBMS経験者は、必ずmysql, mariadbで思ったように動くか
確認する事。

sqlserver
マルチバイト文字がCOBOL式。

azure data studioなどGUIのツールはメジャーなRDBMS
の中では一番使いやすく、いい意味で直感的に使える。

認証周りがカオス
Windows認証にする？sqlserver認証にする？

商用DBにしてはインストールが簡単。
で練習のためつまづくことは他の商用DBよりは少ないだろう。

ストアドはメジャーなRDBMSの中では一番書きやすい。

Windows版とLinux版があるが、Windows版でしか
使えない機能があったりする。
powershellから使うためのツールをMSが出しているので
それを使うと良い。


oracle
MSに比べてGUIのツールが重く、使い勝手が悪い。
これはoracleの能力不足というよりMSのGUIに関するノウハウがすごいということだろう。
vscodeがelectronを使っているにもかかわらず異様に軽く使いやすいのはネット記事でも称賛されていた。

商用DBの中ではインストールの難易度は高い。
コミュニティ版だと最大10GBまでしかDBを作れない。
oracle linuxにインストールするなら簡単だが、rhelにインストールしたり、
サポートされていないが、fedora, centosにインストールしようとすると自分で考える必要がある。
oracle listnerなど独自の考え方も多いのでインストールにつまづく可能性はある。

一度インストールできてしまえば、つまづくところは少ないだろう。

oracleの仕組みを参考にしているRDBMSは多いので、
oracleの知識をつけておくと他のRDBMSを触る時にも役に立つ。

sqlplusが使いづらかったり、痒いところに手が届かないのが
問題。
sqlplusでバッチ処理を描くより、pythonやgolangで描く方が
簡単かつ管理が楽だと思う。

日本ではosqleditという非公式のツールが幅を利かせているが、
日本でしか使われていないので、問題があった時困ると思うが...

エディタに関しては
vscodeにあるoracleのextensionを使うことをお勧めする。


DB2
商用DBの中ではインストールの難易度は真ん中ぐらい。
IBMのRDBMS。oracleよりライセンスが安く、
コミュニティ版だと無料で使える。

RDBMSに関してはoracleよりも新しい技術を取り入れていることもあるらしい。
銀行など金融系のシステムに向く。
メジャーなRDBMSの中では唯一律儀に
CREATE CATALOGという
標準SQLに従っている。
これはCREATE DATABASEのことであり、
IBMだけが変わった呼び方をしているのではなく、
RDBMSでDB2だけが律儀に
CREATE CATALOGという構文を実装しているのだ。
CREATE CATALOGがCREATE DATABASEのエイリアスだったり。



## ストアドファンクション

1. そもそもRDBMSを提供する側の温度感を見ておく。

oracleは

1. 無駄なループや、描きがち

2. デバッグがムズイ。

3. メモリを増やすだけでいいので問題の切り分けが楽。

4. 総合的にはselectする値を加工する、
計算用の

5. 

メリット
apiサーバー, webサーバー, スマホなど端末側と複数の場所で値の加工処理があると
面倒であり、
加工するという処理においてはメリットは昔よりもむしろ上がっていると思う。
全体としての計算処理のコストを抑えられる。

デメリット
jsdocなど決まった形式のコメントがない。
vscodeなどのエディタのインテリセンスが賢くない。
oracle, mysqlなどはストアドが貧弱かつ書き方に癖が強い。
sqlが前提として書ける必要がある。
よって要求されるスキルが高い。
oracleは一番ネットに例が多くoracle社員のブログやコラムはかなり参考になる。

## サロゲートキー

1. サロゲートキーとは?

2. 害がないは嘘。

そのサロゲートキーupsertの時に邪魔になりませんか？

3. 規模が大きくなるにつれて邪魔になってくる。

4. サロゲートキー以外にプライマリーになりうるキーがなかったら良い。

## 複合キー

1. Ormマッパーとの相性は悪い。

2. 使い所

1. ユーザーごと~などの集計結果のテーブルに向く。

1. 200x年mm月のユーザーが支払ったかどうか？

書く月に対して複数請求書がありうるなら
ユーザーid, 月,
書く月に対してm、各個人ごとの請求書など
ユーザーid, 月

## 集計の罠

その計算、スクリプト言語なら誤差できませんか？

1. 運送量システムなどは小数点以下の金額が出る事も多い。

2. 消費税。

1. 1にならず0.999999になる言語

2. 計算をsqlに寄せると早い上にあまり考えなくて良い。

3. 

## 
